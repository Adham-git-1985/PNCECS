{% extends "/en/layout.html" %}
{% block title %}Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±{% endblock %}

{% block content %}
<div class="container my-5">

<h1 class="page-title mt-4 text-primary text-center">ğŸ“¸ Gallery</h1>
  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
  <form method="GET" class="mb-4">
    <div class="row g-2">
      <div class="col-md-3">
        <button type="submit" class="btn btn-primary w-100">Search</button>
      </div>
      <div class="col-md-9">
        <input type="text"
               name="q"
               class="form-control"
               placeholder="ğŸ” Search in Images..."
               value="{{ request.args.get('q', '') }}">
      </div>

    </div>
  </form>

  {% if images %}
    <!-- Ø´Ø¨ÙƒØ© Masonry Ø¨Ø³ÙŠØ·Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… CSS Columns -->
    <div class="grid">
      {% for image in images %}
        <div class="grid-item">
          <div class="card border-0 shadow-sm mb-3">
            <!--
              Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©:
              - ÙŠÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ #galleryCarouselModal
              - ÙŠÙ…Ø±Ù‘Ø± data-index=loop.index0 Ø¥Ù„Ù‰ JS Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´Ø±ÙŠØ­Ø©
            -->
            <a href="#"
               class="gallery-thumb"
               data-bs-toggle="modal"
               data-bs-target="#galleryCarouselModal"
               data-index="{{ loop.index0 }}">
              <img src="{{ url_for('static', filename='images/gallery/' + image.filename) }}"
                   class="img-fluid"
                   style="object-fit: cover; height: 200px; width: 100%;"
                   alt="{{ image.title or 'ØµÙˆØ±Ø©' }}">
            </a>
            <div class="card-body p-2 text-center">
              {% if image.title %}
                <h6 class="card-title mb-1">{{ image.title }}</h6>
              {% endif %}
              {% if image.description %}
                <p class="card-text text-muted small mb-0">{{ image.description }}</p>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª -->
    {% if pagination.pages > 1 %}
      <nav class="mt-4">
        <ul class="pagination justify-content-center">
          {% if pagination.has_prev %}
            <li class="page-item">
              <a class="page-link"
                 href="?page={{ pagination.prev_num }}{% if request.args.get('q') %}&q={{ request.args.get('q') }}{% endif %}">
                Ø§Ù„Ø³Ø§Ø¨Ù‚
              </a>
            </li>
          {% endif %}
          {% for p in range(1, pagination.pages + 1) %}
            <li class="page-item {% if p == pagination.page %}active{% endif %}">
              <a class="page-link"
                 href="?page={{ p }}{% if request.args.get('q') %}&q={{ request.args.get('q') }}{% endif %}">
                {{ p }}
              </a>
            </li>
          {% endfor %}
          {% if pagination.has_next %}
            <li class="page-item">
              <a class="page-link"
                 href="?page={{ pagination.next_num }}{% if request.args.get('q') %}&q={{ request.args.get('q') }}{% endif %}">
                Ø§Ù„ØªØ§Ù„ÙŠ
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% else %}
    <p class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù„Ø¹Ø±Ø¶Ù‡Ø§.</p>
  {% endif %}
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Carousel Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙƒØ§Ù…Ù„Ø© -->
{% if images %}
  <div class="modal fade" id="galleryCarouselModal" tabindex="-1" aria-labelledby="galleryCarouselLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content bg-dark">
        <div class="modal-header border-0">
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
        </div>
        <div class="modal-body p-0">
          <div id="galleryCarousel" class="carousel slide" data-bs-ride="false">
            <div class="carousel-inner">
              {% for image in images %}
                <div class="carousel-item {% if loop.first %}active{% endif %}">
                  <img src="{{ url_for('static', filename='images/gallery/' + image.filename) }}"
                       class="d-block mx-auto img-fluid"
                       style="max-height: 80vh;"
                       alt="{{ image.title or 'ØµÙˆØ±Ø©' }}">
                  {% if image.title or image.description %}
                    <div class="carousel-caption d-none d-md-block bg-black bg-opacity-50 rounded p-3">
                      {% if image.title %}
                        <h5>{{ image.title }}</h5>
                      {% endif %}
                      {% if image.description %}
                        <p class="small">{{ image.description }}</p>
                      {% endif %}
                    </div>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
            <button class="carousel-control-prev" type="button" data-bs-target="#galleryCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#galleryCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Ø§Ù„ØªØ§Ù„ÙŠ</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endif %}
{% endblock %}

{% block scripts %}
  {{ super() }}
  <style>
    /* ---------- CSS Ø´Ø¨ÙƒØ© Masonry Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… CSS Columns ---------- */
    .grid {
      column-count: 4;
      column-gap: 1rem;
    }
    @media (max-width: 992px) {
      .grid {
        column-count: 3;
      }
    }
    @media (max-width: 768px) {
      .grid {
        column-count: 2;
      }
    }
    @media (max-width: 576px) {
      .grid {
        column-count: 1;
      }
    }

    .grid-item {
      break-inside: avoid;
      margin-bottom: 1rem;
      transition: transform 0.3s ease;
    }
    .grid-item:hover {
      transform: translateY(-4px) scale(1.02);
    }
    .card {
      border-radius: 8px;
      overflow: hidden;
    }
    /* ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
    .card img {
      display: block;
      width: 100%;
      height: auto;
    }
    /* ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
    .card-body {
      background: #f9f9f9;
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙØ¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ØŒ Ù†Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
      var galleryModal = document.getElementById('galleryCarouselModal');
      galleryModal.addEventListener('show.bs.modal', function (event) {
        // Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø°ÙŠ ÙÙØ¹Ù‘Ù„ (click) ÙƒØ§Ù† <a class="gallery-thumb">...
        var thumb = event.relatedTarget;
        var index = parseInt(thumb.getAttribute('data-index'), 10);
        var carousel = bootstrap.Carousel.getOrCreateInstance(document.getElementById('galleryCarousel'));
        carousel.to(index);
      });
    });
  </script>
{% endblock %}
