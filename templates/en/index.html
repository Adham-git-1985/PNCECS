{% extends "en/layout.html" %}

{% block title %}Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„ÙˆØ·Ù†ÙŠØ©{% endblock %}

{% block announcements %}
<div class="announcements-vertical">
  <div class="announcements-header">announcements</div>
  <ul class="announcements-vertical-list">
    {% for ann in announcements_list %}
  <li>
    <a href="{{ url_for('announcement_detail', id=ann.id) }}">
      {{ ann.title }}
    </a>
  </li>
{% endfor %}

  </ul>
</div>
{% endblock %}


{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

{% if top_images is defined and top_images %}
<style>
  .carousel-caption h4 a {
    font-size: 1.1rem;
    background-color: rgba(255, 255, 255, 0.8);
    padding: 6px 12px;
    border-radius: 8px;
    color: #000 !important;
    text-decoration: none;
    transition: all 0.3s ease-in-out;
  }

  .carousel-caption h4 a:hover {
    background-color: #cdab35;
    color: #fff !important;
  }

  /* Ø­Ø±ÙƒØ© Ø§Ù„Ø²ÙˆÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© */
  .carousel-item img {
    transition: transform 0.5s ease;
  }

  .carousel-item img:hover {
    transform: scale(1.1);
    transition: transform 0.5s ease;
  }

  .carousel-caption {
    position: absolute;
    bottom: 50px;
    left: 20px;
    right: 20px;
    color: white;
    opacity: 0;
    animation: slideIn 1s forwards;
  }
  /* ØªØ­Ø¯ÙŠØ¯ Ø­Ø±ÙƒØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
  @keyframes slideIn {
    0% {
      transform: translateY(80px);
      opacity: 0;
    }
    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }
  .top-image-badge {
    position: absolute;
    top: 15px;
    left: 15px;
    background-color: #cdab35;
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.9rem;
    z-index: 10;
  }
  canvas {
  border: 1px solid gold; /* Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØ§Ù† Ø§Ù„Ù€ canvas */
}

</style>

<!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>

<!-- ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.177/pdf.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const thumbs = document.querySelectorAll("canvas.pdf-thumb");
  thumbs.forEach(canvas => {
    const url = canvas.dataset.pdfUrl;
    const context = canvas.getContext("2d");

    pdfjsLib.getDocument(url).promise
      .then(pdf => pdf.getPage(1))
      .then(page => {
        const scale = 0.3;  // Ø¶Ø¨Ø·ÙŠ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ ÙƒÙ…Ø§ ØªØ±ÙŠØ¯
        const viewport = page.getViewport({ scale });
        canvas.width  = viewport.width;
        canvas.height = viewport.height;
        page.render({ canvasContext: context, viewport });
      })
      .catch(err => console.error("PDF render error:", err));
  });
});
</script>



<div id="topCarousel" class="carousel slide mb-4" data-bs-ride="carousel" role="region" aria-label="Ø´Ø±ÙŠØ· Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØªØ­Ø±Ùƒ">
  <div class="carousel-inner">
    {% for img in top_images %}
    <div class="carousel-item {% if loop.first %}active{% endif %}" style="position: relative;">

<div style="border: 4px solid #cdab35; border-radius: 8px; overflow: hidden;">
  <img src="{{ url_for('static', filename='images/top_images/' + img.image) }}" class="img-fluid w-100" alt="{{ img.title or 'ØµÙˆØ±Ø©' }}" loading="lazy">
</div>
      {% if img.created_at and img.created_at >= (now - timedelta(days=7)) %}
        <span class="top-image-badge">new</span>
      {% endif %}

      <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
        {% if img.news_id %}
          <h4>
            <a href="{{ url_for('news_detail', news_id=img.news_id) }}" rel="noopener noreferrer">
              ğŸ“Œ {{ img.description or "news details" }}
            </a>
          </h4>
        {% elif img.news_title %}
          <h4>
            <a href="{{ url_for('news') }}?q={{ img.news_title }}" rel="noopener noreferrer">
              ğŸ” Ø¨Ø­Ø« Ø¹Ù†: {{ img.news_title }}
            </a>
          </h4>
        {% endif %}
        {% if img.news_content %}
          <p class="mb-0 small text-white">{{ img.news_content[:150] }}...</p>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
<!-- Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ -->
<button class="carousel-control-prev" type="button" data-bs-target="#topCarousel" data-bs-slide="prev">
  <span class="custom-carousel-arrow" aria-hidden="true">â®</span>
  <span class="visually-hidden">Previous</span>
</button>
<!-- Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ -->
<button class="carousel-control-next" type="button" data-bs-target="#topCarousel" data-bs-slide="next">
  <span class="custom-carousel-arrow" aria-hidden="true">â¯</span>
  <span class="visually-hidden">Next</span>
</button>

</div>
{% endif %}




<!-- Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ø®Ø¨Ø§Ø± -->
<div class="container my-5">
  <h2 class="mb-4" style="color: #cdab35; text-align: center;
  border: 2px solid #cdab35;
  padding: 10px 20px;
  border-radius: 8px;">
  ğŸ“° Latest News
</h2>
  <div class="row row-cols-1 row-cols-md-3 g-4">
    {% for item in news_list[:6] %}
    <div class="col">
      <div class="card h-100">
        {% set image = item.gallery[0] if item.gallery else None %}
        {% if image %}
        <a href="{{ url_for('static', filename='images/gallery/' + image.filename) }}" data-lightbox="index-news" data-title="{{ item.title }}">
          <img src="{{ url_for('static', filename='images/gallery/' + image.filename) }}" class="card-img-top" alt="{{ item.title }}" loading="lazy">
        </a>
        {% endif %}
        <div class="card-body">
          <h5 class="card-title" style="color: #cdab35;">{{ item.title }}</h5>
          <p class="card-text">{{ item.content[:120] }}...</p>
          <a href="{{ url_for('news_detail', news_id=item.id) }}" class="btn btn-sm btn-outline-primary" style="border-color: #cdab35; color: #cdab35;">Read More</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
 <!-- Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ø®Ø¨Ø§Ø± -->
<section id="latest-news" class="mb-3">
  <div class="d-flex justify-content-center mt-4">
    <a href="{{ url_for('news') }}" class="btn btn-primary">
      More News
    </a>
  </div>
</section>
</div>

<!-- Ù‚Ø³Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª -->
<h2 class="mt-n3 mb-4" style="
    color: #cdab35;
    text-align: center;
    border: 2px solid #cdab35;
    padding: 10px 20px;
    border-radius: 8px;
">
  Publishments
</h2>

<!-- âœ… Ø®Ù„ÙÙŠØ© ÙƒØ±ÙŠÙ…ÙŠØ© -->
<div class="mb-4 p-4 rounded" style="background-color: #f8f9fa;">
  {% for category, version_list in {'Basamat Magazine': versions_basmat, 'Papers and Studies': versions_papers, 'Violations Observatory': versions_marsad}.items() %}
    <div class="d-flex justify-content-start align-items-center mb-3">
      <h3 class="basamat-title">{{ category }}</h3>
    </div>

    <!-- Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª -->
    <div id="versionsCarousel{{ loop.index }}" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner">
        {% set per_slide = 3 %}
        {% set total = version_list|length %}
        {% for start in range(0, total, per_slide) %}
          <div class="carousel-item {% if start == 0 %}active{% endif %}">
            <div class="row justify-content-center gx-3">
              {% for version in version_list[start:start+per_slide] %}
              <div class="col-4 text-center">
                <a href="{{ url_for('static', filename=version.file_path) }}" target="_blank">
                  <canvas class="pdf-thumb mx-auto "
                          data-pdf-url="{{ url_for('static', filename=version.file_path) }}"
                          style="max-width:200px; max-height:200px; border: 3px solid #cdab35	; border-radius: 8px;"></canvas>
                  <p class="version-title">{{ version.title }}</p>
                </a>
              </div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
      <button class="carousel-control-prev" type="button"
              data-bs-target="#versionsCarousel{{ loop.index }}" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button"
              data-bs-target="#versionsCarousel{{ loop.index }}" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>

    <!-- âœ… ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
    {% if not loop.last %}
      <hr class="my-5" style="border-top: 2px solid #cdab35;">
    {% endif %}
  {% endfor %}
</div>




<!-- Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø© -->
<div class="container my-5">
  <div class="container my-5">
  <h2 class="mb-4" style="color: #cdab35; text-align: center;
  border: 2px solid #cdab35;
  padding: 10px 20px;
  border-radius: 8px;">
Quick Links
</h2>
  <div class="row text-center">
    <div class="col-md-3 mb-3">
      <a href="/news" class="btn btn-outline-secondary w-100" style="border-color: #cdab35; color: #cdab35;">News</a>
    </div>
    <div class="col-md-3 mb-3">
      <a href="/partners" class="btn btn-outline-secondary w-100" style="border-color: #cdab35; color: #cdab35;">Partners of PNCECS</a>
    </div>
    <div class="col-md-3 mb-3">
      <a href="/cultural_forum" class="btn btn-outline-secondary w-100" style="border-color: #cdab35; color: #cdab35;">Cultural Forum</a>
    </div>
    <div class="col-md-3 mb-3">
      <a href="/gallery" class="btn btn-outline-secondary w-100" style="border-color: #cdab35; color: #cdab35;">Gallery</a>
    </div>
  </div>
</div>

{% endblock %}
